// 2021-05-24 14:45

class Builder{constructor(){this.config,this.pathname=window.location.pathname,this.category,this.city,this.heroesTemplates={},this.offersTemplates={},this.mainTop=document.getElementById("main-top"),this.mainContent=document.getElementById("main-content"),this.mainSpinner=document.getElementById("main-spinner"),this.mainBottom=document.getElementById("main-bottom"),this.heroes=document.querySelectorAll(".hero-template"),this.offers=document.querySelectorAll(".template-offer"),this.templatesContainer=document.querySelector(".templates-container"),this.vw=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),this.vh=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),this.templateFaq=document.getElementById("template-faq"),this.faqItemTemplate=document.getElementById("template-accordion-item"),this.bannerSideBySideTemplate=document.querySelector(".template-offer-banner"),this.bannerColumnTemplate=document.querySelector(".template-offer-banner-column"),this.bannerMapTemplate=document.querySelector(".template-offer-banner-map"),this.bannerMapTemplate2=document.querySelector(".template-offer-banner-map-2"),this.checkListTemplate=document.querySelector(".template-check-list"),this.mapSectionTemplate=document.querySelector(".template-map-section-img-container"),this.templateHowItWorks=document.getElementById("template-how-it-works"),this.init()}init(){this.processTemplates(),this.config=configLocationData,this.validateConfig(),this.initComplete()}getConfig(e){let t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET","/config.json",!0),t.onreadystatechange=function(){4==t.readyState&&"200"==t.status&&e(t.responseText)},t.send(null)}processTemplates(){let e=this;this.heroes.forEach(function(t,i){e.heroesTemplates[t.dataset.name]=t.cloneNode(!0)}),this.offers.forEach(function(t,i){e.offersTemplates[t.dataset.name]=t.cloneNode(!0)})}validateConfig(){let e=this,t=this.pathname.split("/");this.category=t[1],this.city=t[2],void 0!==this.config[this.category]&&void 0!==this.config[this.category][this.city]?(e.mainSpinner.classList.add("d-none"),this.buildLanding()):"/work/base.min.html"==this.pathname?(this.category="deals",this.city="orlando",void 0===this.config[this.category]&&(this.category="offers"),e.mainSpinner.classList.add("d-none"),this.buildLanding()):window.location.replace(siteUrl)}buildLanding(){let e=this,t=this.config[this.category][this.city],i=this.config.global[this.category],o=this.heroesTemplates[t.hero.template].cloneNode(!0);o=this.customizeHero(o,t.hero,t.definitions.location,t.hero.template),e.mainTop.append(o);let n=this.offersTemplates[t.offers.template],r=document.createElement("div");r.className="row gx-0 gx-md-2 gx-lg-3 gy-3 main-content-offers "+t.offers.container_classes,e.mainContent.append(r);let l=0,a=0;document.querySelectorAll("."+t.offers.action_class).forEach(function(i,o){let n=window.location.search;n+="&dslp_pathname="+encodeURI(window.location.pathname),n+="&dslp_himg="+encodeURI(t.hero.img),n+="&dslp_hcity="+encodeURI(t.definitions.location),n+="&dslp_hcount="+encodeURI(e.config.counts[e.city].hotels);let r=e.buildLink(t.offers.action_url,n);i.setAttribute("href",r)});let c=t.offers.list.length;t.offers.list.forEach(function(i,o){let s=!1,d=n.cloneNode(!0);if(c>1&&c==o+1&&d.classList.add("last-odd"),d=e.customizeOffer(d,i,t.offers.template),e.addUrlToElement(t.offers.action_url,t.offers.action_class,d,i),r.append(d),++l>=3&&e.vw<=767&&void 0!==t.banners[a]){let i;l=0,0==a?(i=e.bannerMapTemplate2.cloneNode(!0),void 0!==t.banners[a].img&&""!=t.banners[a].img&&(i.style.backgroundImage="url('"+t.banners[a].img+"')",s=!0)):i=e.bannerColumnTemplate.cloneNode(!0),i.querySelector(".j-offer-banner-title").innerHTML=t.banners[a].title,i.querySelector(".j-offer-banner-subtitle").innerHTML=t.banners[a].description,i.querySelector(".j-offer-banner-action").innerHTML=t.banners[a].button,i.classList.remove("d-none"),r.append(i),a++,s&&e.initParallax(".template-offer-banner-map-2")}}),document.querySelector(".j-privacy-url").setAttribute("href",t.definitions.privacy_policy_url),void 0!==i.faq.qs&&i.faq.qs.length>0&&e.customizeFAQ(i.faq),void 0!==i.how_it_works&&e.customizeHowItWorks(i.how_it_works),void 0!==t.map_section&&e.customizeMapSection(t.map_section),void 0!==i.check_list&&e.customizeCheckList(i.check_list,t.map_section.image||""),this.templatesContainer.remove(),document.querySelectorAll(".j-offer-banner-action").forEach(function(i,o){let n=window.location.search;n+="&dslp_pathname="+encodeURI(window.location.pathname),n+="&dslp_himg="+encodeURI(t.hero.img),n+="&dslp_hcity="+encodeURI(t.definitions.location),n+="&dslp_hcount="+encodeURI(e.config.counts[e.city].hotels);let r=e.buildLink(t.offers.action_url,n);i.setAttribute("href",r)})}customizeHero(e,t,i,o){return"banner"==o?(e.querySelector(".j-hero-image").style.backgroundImage="url('"+t.img+"')",e.querySelector(".j-hero-banner-img").src=t.brand_img,e.querySelector(".j-hero-title").innerHTML=t.title,e.querySelector(".j-hero-subtitle").innerHTML=t.sub_title,e.querySelector(".j-hero-banner-1").innerHTML=i,e.querySelector(".j-hero-banner-2").innerHTML=t.title,e.querySelector(".j-hero-action").innerHTML=t.action):"centered"==o&&(e.querySelector(".j-hero-image").style.backgroundImage="url('"+t.img+"')",e.querySelector(".j-hero-title").innerHTML=t.title,e.querySelector(".j-hero-content").innerHTML=t.content,e.querySelector(".j-hero-action").innerHTML=t.action),e}customizeHowItWorks(e,t=null){if(void 0!==e.video_url){let t=this.templateHowItWorks.cloneNode(!0),i=t.querySelector(".template-how-it-works-title"),o=t.querySelector(".template-how-it-works-text"),n=t.querySelector(".template-how-it-works-video-container"),r=t.querySelector(".template-how-it-works-img");i.innerText=e.title,o.innerHTML=e.content,r.setAttribute("alt",e.title),r.setAttribute("src",e.thumbnail_url),r.dataset.vid=e.video_url,this.mainContent.append(t),r.addEventListener("click",function(){let t=document.createElement("video");t.classList.add("w-100"),t.classList.add("h-auto"),t.classList.add("shadow"),t.poster=e.thumbnail_url,t.setAttribute("controls","");let i=document.createElement("source");i.setAttribute("src",e.video_url),t.appendChild(i),r.remove(),n.append(t),t.play(),t.addEventListener("touchstart",function(){this.paused?this.play():this.pause()},!1)},!1)}}customizeFAQ(e,t=null){if(e.qs.length){let t=this,i=t.templateFaq.cloneNode(!0),o=i.querySelector("#faq-accordion");if(e.qs.forEach(function(e,i){let n=t.faqItemTemplate.cloneNode(!0);n.removeAttribute("id");const r="q"+(i+1),l="a"+(i+1);n.querySelector(".j-accordion-header").id=r,n.querySelector(".j-faq-accordion-question").innerText=e.q,n.querySelector(".j-faq-accordion-question").dataset.bsTarget="#"+l,n.querySelector(".j-faq-accordion-question").setAttribute("aria-controls",l),n.querySelector(".j-faq-accordion-body").innerText=e.a,n.querySelector(".j-faq-accordion-collapse").id=l,n.querySelector(".j-faq-accordion-collapse").setAttribute("aria-labelledby",r),o.append(n)}),void 0!==e.action_title){let t=`<h2 class="accordion-header j-accordion-header" id="">\t\n                                <a target="_blank" href="${e.action_url}" >${e.action_title}</a>\t\n                              </h2>`,i=document.createElement("div");i.classList.add("accordion-item"),i.classList.add("accordion-action"),i.innerHTML=t,o.append(i)}t.mainContent.append(i)}}customizeCheckList(e,t,i=null){if(void 0!==e.title&&void 0!==e.items){let i=this,o=i.checkListTemplate.cloneNode(!0);o.querySelector(".j-template-check-list-title").innerText=e.title,o.querySelector(".j-template-check-list-description").innerText=e.description,o.querySelector(".j-template-check-list-btn-text").innerText=e.btn_text,o.querySelector(".j-template-check-list-btn-text").setAttribute("href",e.action_url),o.querySelector(".j-template-check-list-img").setAttribute("src",t),o.querySelector(".j-template-check-list-img").setAttribute("alt",e.img_alt);let n="";e.items.forEach(function(e,t){n+='<div class="mb-3"><i class="bi bi-check-lg text-green d-inline-block mr-2 clearfix"></i><span class="d-inline-block">'+e+"</span></div>"}),o.querySelector(".check-list-container").innerHTML=n,i.mainContent.append(o)}}customizeMapSection(e,t=null){if(void 0!==e.image){let t=this,i=t.mapSectionTemplate.cloneNode(!0);i.querySelector(".j-template-map-section-img").setAttribute("src",e.image),t.mainContent.append(i)}}customizeOffer(e,t,i){if("blog"==i);else if("card"==i&&(e.querySelector(".j-offer-image-container").style.backgroundImage="url('"+t.img+"')",e.querySelector(".j-offer-title").innerHTML=t.title,e.querySelector(".j-offer-content").innerHTML=t.content,e.querySelector(".j-offer-action").innerHTML=t.action,void 0!==t.highlight_box)){let i=e.querySelector(".j-offer-highlight-section");void 0!==t.highlight_box.action_url&&i.setAttribute("href",t.highlight_box.action_url),void 0!==t.highlight_box.action_class&&i.classList.add(t.highlight_box.action_class),e.querySelector(".j-offer-hl-1").innerHTML=t.highlight_box.line1,e.querySelector(".j-offer-hl-2").innerHTML=t.highlight_box.line2,e.querySelector(".j-offer-hl-3").innerHTML=t.highlight_box.line3,i.classList.remove("d-none")}return e}buildLink(e,t){if(!t.length)return e;return e.split("?").length>1?e+"&"+(t=t.substring(1)):e+t}addUrlToElement(e,t,i,o){let n=window.location.search;n+="&dslp_pathname="+encodeURI(window.location.pathname),void 0!==o.property_details.propType&&(n+="&dslp_propertyType="+o.property_details.propType),void 0!==o.property_details.propId&&(n+="&dslp_propertyId="+o.property_details.propId),void 0!==o.highlight_box.line2&&(n+="&dslp_pct="+o.highlight_box.line2.replace(/%/g,"")),void 0!==o.highlight_box.line2&&(n+="&dslp_himg="+encodeURI(o.img));let r=this.buildLink(e,n);i.querySelectorAll("."+t).forEach(function(e){e.setAttribute("href",r)})}addUrlToElements(e,t){return!1}initComplete(){-1==document.cookie.indexOf("acceptedcookies")&&document.querySelector(".section-cookies-toast").classList.remove("d-none"),this.initEventListeners();let e=function(){var t=document.body.scrollHeight;t*=.8,window.scrollY+window.innerHeight>=t&&(fbq("track","Scrolled80"),window.removeEventListener("scroll",e))};window.addEventListener("scroll",e)}initEventListeners(){let e=this;document.getElementById("btn-section-cookies-toast").addEventListener("click",function(){e.createCookie("acceptedcookies",1,30),document.querySelector(".section-cookies-toast").remove()},!1)}createCookie(e,t,i){var o;if(i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3),o="; expires="+n.toGMTString()}else o="";document.cookie=e+"="+t+o+"; path=/"}initParallax(e,t=-.3){}}let app=new Builder;